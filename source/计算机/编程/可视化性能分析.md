---

> TODO

xperf
https://blogs.msdn.microsoft.com/ntdebugging/2008/04/03/windows-performance-toolkit-xperf/

http://windowsitpro.com/windows-server/q-where-can-i-download-xperf-and-xperfview-tools

包含在win sdk里
http://msdn.microsoft.com/en-us/windowsserver/bb980924.aspx



## 火焰图

参考：

https://blog.csdn.net/gatieme/article/details/78885908

https://github.com/brendangregg/FlameGraph
https://github.com/brendangregg/FlameGraph/blob/master/example-dtrace-stacks.txt
http://www.brendangregg.com/flamegraphs.html

火焰图就是通过定时采样堆栈信息，生成“时间占比-堆栈层次”的图表，通过观察函数执行时间占比（越宽占用时间越长）、CPU使用程度（颜色越深吃的CPU资源越多）来调优程序性能，“平顶山”式的图形一般就是要优化的地方。

局限性：由于原理是采样，信息是不完整的，无法观察到调用过深的情况；只适合观察同步阻塞，而通过异步实现的延迟无法观察。

### 用perf捕捉堆栈信息

程序编译时应使用`-Og -g`。

```
# perf record -F 99 -p <pid> -g
```

简单看看采集到的东西，但数据一多就没法看了：

```
# perf report -n --stdio
```

### 用FlameGraph生成火焰图

安装：

```
yay -S flamegraph
```

生成：

```
# perf script | stackcollapse-perf.pl | flamegraph.pl > process.svg
```

